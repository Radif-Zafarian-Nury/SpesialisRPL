<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Pasien</title>
    <link rel="stylesheet" type="text/css" th:href="@{/Admin/listPasien.css}">
</head>

<body>
    <!-- Sidebar -->
    <th:block th:include="~{Admin/sidebar :: sidebarAdmin}"></th:block>

    <!-- Main Content -->
    <div class="main-content">
        <header>
            <span>Search Pasien</span>
            <div class="right">
                <span>Hi, Admin</span>
                <a th:href="@{/logout}"><button>Logout</button></a>
            </div>
        </header>

        <!-- Search bar -->
        <div class="search-bar">
            <form method="GET" th:action="@{/admin/list-pasien}" id="searchForm">
                <input type="text" id="searchInput" placeholder="Cari nomor rekam medis pasien" onkeydown="checkKey()">
                <button onclick="this.form.submit()">Cari</button>
            </form>
            
        </div>

        <!-- Filter Tanggal -->
        <div class="tanggal-wrapper">
            <div class="filter-tanggal">
                <form method="GET" th:action="@{/admin/list-pasien}" id="filterForm">
                    <div class="tanggal">
                        <input type="date" name="tgl" th:value="${tgl}" onchange="this.form.submit()" />
                    </div>
                </form>
            </div>
        </div>

        <!-- Patient List -->
        <div class="patient-list" id="patientList">
            <!-- Patient cards will be displayed here -->
            <div class="patient-card" th:each="row : ${results}">
                <div class="patient-info">
                    <span th:text="${row.nama}"></span>
                    <p th:text="'Dokter: ' +${row.nama_dokter}"></p>
                    <p th:text="'Spesialisasi: ' + ${row.nama_spesialisasi} "></p>
                    <!-- <p th:text="'Tanggal: ' + ${row.tanggal}"></p> -->
                    <span th:text="${row.waktu_mulai} + ' - ' + ${row.waktu_selesai}"></span>
                    <p th:if="${row.status_bayar}">Status Pembayaran: Sudah Bayar</p>
                    <p th:if="${!row.status_bayar}">Status Pembayaran: Belum Bayar</p>
                    <p th:if="${row.status_daftar_ulang}">Sudah Daftar Ulang</p>
                    <p th:if="${!row.status_daftar_ulang}">Belum Daftar Ulang</p>
                    <p th:text="'No antrian: ' + ${row.no_antrian}"></p>
                </div>
                <div class="button-group">
                    <button class="status-btn" onclick="bayar()">Tandai Sudah Bayar</button>
                    <button class="reregister-btn" onclick="daftarUlang()">Daftar Ulang</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function checkKey(){
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    this.form.submit();
                }
            })
        }

        // async function search(){
        //     const nik = document.getElementById
        //     if (nik != null) {
        //         try {
        //             const response = await fetch(`/admin/check-nik?nik=${nik}`);

        //             if (!response.ok) {
        //                 throw new Error('Pasien belum terdaftar');
        //             }

        //             const data = await response.json();

        //             //isi data ke dalam form
        //             document.getElementById('patientName').value = data.nama || '';
        //             document.getElementById('patientDOB').value = data.tanggalLahir || '';
        //             document.getElementsByName('gender').forEach(radio => {
        //                 if (radio.value === (data.jenisKelamin === 'L' ? 'L' : 'P')) {
        //                     radio.checked = true;
        //                 }
        //             });

        //         } catch (error) {
        //             alert(error.message);
        //         }
        //     }
        // }
        async function bayar() {
            //sama kaya check nik rangsek, tapi pas manggil controller di controllernya ganti status dari database

        }
    </script>
</body>

</html>